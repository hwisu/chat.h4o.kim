import{d as G,p as z,f as C,c,s as M,i as T,t as x,a as _,b as A,e as H,g as L,h as K,j as U,u as B,k as u,l as R,o as V,m as O,n as J,q as P,r as ee,v as X,w as Z,x as te,y as ae,z as se,A as W,B as ne}from"./svelte.js";import{a as q,m as Y,r as oe,b as F,u as j,c as le}from"./services.js";import{H as D}from"./highlight.js";import{m as I}from"./marked.js";var re=C('<div class="chat-header svelte-umztmj"><div class="chat-title svelte-umztmj"><button aria-label="Select model"> </button> <button class="role-title svelte-umztmj" aria-label="Select role"> </button></div> <div class="header-right svelte-umztmj"><div class="header-info svelte-umztmj"><div class="context-info svelte-umztmj"> </div> <div class="auth-status svelte-umztmj"><!></div></div></div></div>');function Ke(b,e){z(e,!0);var s=re(),v=c(s),g=c(v);let m;g.__click=function(...t){var o;(o=e.onModelClick)==null||o.apply(this,t)};var p=c(g),h=M(g,2);h.__click=function(...t){var o;(o=e.onRoleClick)==null||o.apply(this,t)};var n=c(h),d=M(v,2),y=c(d),i=c(y),l=c(i),w=M(i,2),S=c(w);{var r=t=>{var o=K("Server Key");_(t,o)},a=t=>{var o=K();x(()=>L(o,q.status)),_(t,o)};T(S,t=>{q.isAuthenticated?t(r):t(a,!1)})}x((t,o)=>{m=H(g,1,"model-title svelte-umztmj",null,m,t),L(p,Y.selectedInfo.name),L(n,oe.selectedInfo.name),L(l,`Context: ${o??""}K`)},[()=>({authenticated:q.isAuthenticated}),()=>Math.round(Y.selectedInfo.contextSize/1e3)]),_(b,s),A()}G(["click"]);var ie=C('<span class="message-label svelte-1kg7gi5"> </span>'),ce=C('<span class="message-label svelte-1kg7gi5"> </span>'),ve=C("<div><!></div>");function de(b,e){z(e,!0);let s=U(e,"model",3,"");function v(n){return new Date(n).toLocaleTimeString("ko-KR",{hour:"2-digit",minute:"2-digit",hour12:!0})}var g=ve(),m=c(g);{var p=n=>{var d=ie(),y=c(d);x(i=>L(y,`[USER] ${i??""}`),[()=>v(e.timestamp)]),_(n,d)},h=n=>{var d=ce(),y=c(d);x(i=>L(y,`[ASSISTANT] ${i??""}${s()?` - ${s()}`:""}`),[()=>v(e.timestamp)]),_(n,d)};T(m,n=>{e.role==="user"?n(p):n(h,!1)})}x(()=>H(g,1,`message-header ${e.role??""}`,"svelte-1kg7gi5")),_(b,g),A()}var ue=C("<div><!></div>");function Q(b,e){z(e,!0);let s=U(e,"content",3,""),v=U(e,"role",3,"assistant"),g,m=R("");B(()=>{console.log("🔥 CONTENT CHANGED:",{length:s().length,preview:s().substring(0,100),hasCodeBlock:s().includes("```")})});function p(a){const t=document.createElement("div");return t.textContent=a,t.innerHTML}function h(a,t){var o,f;console.log("🎨 highlightCode called with:",{codeLength:a.length,language:t,codePreview:a.substring(0,50)+"..."}),console.log("✅ hljs available, available languages:",((f=(o=D).listLanguages)==null?void 0:f.call(o))||"listLanguages not available");try{if(t&&D.getLanguage(t)){console.log(`🔍 Highlighting with specific language: ${t}`);const k=D.highlight(a.trim(),{language:t});return console.log("✅ Code highlighting successful for",t,"result length:",k.value.length),console.log("🎨 Highlighted result preview:",k.value.substring(0,100)+"..."),k.value}else{console.log("🔍 Auto-detecting language...");const k=D.highlightAuto(a.trim());return console.log("✅ Auto-highlighting successful, detected language:",k.language,"result length:",k.value.length),console.log("🎨 Highlighted result preview:",k.value.substring(0,100)+"..."),k.value}}catch(k){return console.warn("❌ Code highlighting failed:",k),p(a)}}function n(a){if(console.log("📝 processMarkdown called with text length:",a.length),console.log("📝 Text preview:",a.substring(0,200)+"..."),!a)return console.log("❌ No text provided"),"";console.log("🔍 Using npm packages: marked and hljs available");try{const t=new I.Renderer;t.code=function({text:f,lang:k}){console.log("🔧 renderer.code called:",{codeLength:f.length,language:k,codePreview:f.substring(0,50)+"..."});const E=h(f,k);return console.log("🔧 renderer.code result length:",E.length),`<pre><code class="language-${k||"text"} hljs">${E}</code></pre>`},I.setOptions({breaks:!0,gfm:!0,renderer:t});const o=I.parse(a);return console.log("✅ Markdown parsing successful, result length:",o.length),console.log("📝 Parsed result preview:",o.substring(0,200)+"..."),o}catch(t){return console.warn("❌ Markdown parsing failed:",t),console.log("🔄 Falling back to fallbackMarkdown"),d(a)}}function d(a){console.log("🔄 fallbackMarkdown called with text length:",a.length);const t=a.replace(/```(\w+)?\n([\s\S]*?)```/g,(o,f,k)=>{console.log("🔄 fallback processing code block:",{lang:f,codeLength:k.length,codePreview:k.substring(0,50)+"..."});const E=h(k,f);console.log("🔄 fallback highlighted code length:",E.length);const N=`<pre><code class="language-${f||"text"} hljs">${E}</code></pre>`;return console.log("🔄 fallback block result length:",N.length),N}).replace(/`([^`]+)`/g,"<code>$1</code>").replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/\n/g,"<br>");return console.log("🔄 fallbackMarkdown result length:",t.length),console.log("🔄 fallbackMarkdown result preview:",t.substring(0,200)+"..."),t}function y(a){var f;const t=a.target,o=(f=t.closest(".code-block-container"))==null?void 0:f.querySelector("code");o&&navigator.clipboard.writeText(o.textContent||"").then(()=>{t.textContent="✓",setTimeout(()=>{t.textContent="copy"},1e3)})}async function i(){if(await ee(),!g)return;g.querySelectorAll("pre:not(.processed)").forEach(t=>{var k;const o=document.createElement("div");o.className="code-block-container";const f=document.createElement("button");f.className="copy-code-btn",f.textContent="copy",f.title="Copy code",f.addEventListener("click",y),(k=t.parentNode)==null||k.insertBefore(o,t),o.appendChild(f),o.appendChild(t),t.classList.add("processed")})}function l(){console.log("🚀 processContent called with content length:",s().length),console.log("🚀 Content preview:",s().substring(0,100)+"..."),P(m,n(s()),!0),console.log("🚀 processContent finished, processedContent length:",u(m).length),console.log("🚀 ProcessedContent preview:",u(m).substring(0,200)+"...")}B(()=>{s()&&l()}),B(()=>{u(m)&&g&&i()}),V(()=>{l()});var w=ue();let S;var r=c(w);O(r,()=>u(m)),J(w,a=>g=a,()=>g),x(a=>S=H(w,1,"code-highlighter svelte-ezov7",null,S,a),[()=>({user:v()==="user",assistant:v()==="assistant"})]),_(b,w),A()}var ge=C('<div class="user-message-wrapper svelte-1xhsxcs"><div><!></div></div>'),he=C("<div><!></div>");function me(b,e){var s=X(),v=Z(s);{var g=p=>{var h=ge(),n=c(h),d=c(n);Q(d,{get content(){return e.content},get role(){return e.role}}),x(()=>H(n,1,`message-content ${e.role??""}`,"svelte-1xhsxcs")),_(p,h)},m=p=>{var h=he(),n=c(h);Q(n,{get content(){return e.content},get role(){return e.role}}),x(()=>H(h,1,`message-content ${e.role??""}`,"svelte-1xhsxcs")),_(p,h)};T(v,p=>{e.role==="user"?p(g):p(m,!1)})}_(b,s)}function fe(b,e){navigator.clipboard.writeText(e.content).then(()=>{})}var _e=C('<div class="message-footer svelte-sspqos"><div class="token-usage svelte-sspqos"><!></div> <button class="copy-button svelte-sspqos">Copy all</button></div>');function ke(b,e){z(e,!0);var s=_e(),v=c(s),g=c(v);{var m=n=>{var d=K();x((y,i,l)=>L(d,`↑ ${y??""}K ↓ ${i??""}K (total: ${l??""}K)`),[()=>Math.round(e.tokenUsage.prompt_tokens/1e3),()=>Math.round(e.tokenUsage.completion_tokens/1e3),()=>Math.round((e.tokenUsage.total_tokens||e.tokenUsage.prompt_tokens+e.tokenUsage.completion_tokens)/1e3)]),_(n,d)},p=(n,d)=>{{var y=l=>{var w=K();x(S=>L(w,`total: ${S??""}K`),[()=>Math.round(e.tokenUsage.total_tokens/1e3)]),_(l,w)},i=(l,w)=>{{var S=r=>{var a=K();x((t,o)=>L(a,`↑ ${t??""}K ↓ ${o??""}K`),[()=>Math.round(e.tokenUsage.input/1e3),()=>Math.round(e.tokenUsage.output/1e3)]),_(r,a)};T(l,r=>{e.tokenUsage.input&&e.tokenUsage.output&&r(S)},w)}};T(n,l=>{e.tokenUsage.total_tokens?l(y):l(i,!1)},d)}};T(g,n=>{e.tokenUsage.prompt_tokens&&e.tokenUsage.completion_tokens?n(m):n(p,!1)})}var h=M(v,2);h.__click=[fe,e],_(b,s),A()}G(["click"]);var pe=C("<div><!> <!> <!></div>");function be(b,e){let s=U(e,"role",3,"user"),v=U(e,"content",3,""),g=U(e,"timestamp",19,()=>Date.now()),m=U(e,"model",3,""),p=U(e,"tokenUsage",19,()=>({}));var h=pe(),n=c(h);de(n,{get role(){return s()},get timestamp(){return g()},get model(){return m()}});var d=M(n,2);me(d,{get role(){return s()},get content(){return v()}});var y=M(d,2);{var i=l=>{ke(l,{get tokenUsage(){return p()},get content(){return v()}})};T(y,l=>{s()==="assistant"&&l(i)})}x(()=>{H(h,1,`message ${s()??""}`,"svelte-12i571y"),te(h,"data-timestamp",g())}),_(b,h)}var we=C('<div class="message system svelte-3u4su5"><div class="message-content svelte-3u4su5"><!></div> <div class="message-timestamp svelte-3u4su5"> </div></div>'),ye=C('<div><div class="message-content svelte-3u4su5"><!></div> <div class="message-timestamp svelte-3u4su5"> </div></div>'),Ce=C('<div class="message assistant loading svelte-3u4su5"><div class="message-content svelte-3u4su5"><div class="loading-dots svelte-3u4su5"><span class="svelte-3u4su5"></span> <span class="svelte-3u4su5"></span> <span class="svelte-3u4su5"></span></div></div></div>'),xe=C('<div class="chat-output svelte-3u4su5"><!> <!> <!></div>');function Be(b,e){z(e,!0);let s;function v(){s&&(s.scrollTop=s.scrollHeight)}B(()=>{F.length,v()}),V(()=>{v()});function g(){return`[SYSTEM] ${new Date().toLocaleString()}

🌟 Choose access method:

🔐 Server Login: /login <password>
🔑 Personal Key: /set-api-key <key>

💡 Choose ONE option`}var m=xe(),p=c(m);{var h=i=>{var l=we(),w=c(l),S=c(w);O(S,()=>g().replace(/\n/g,"<br>"));var r=M(w,2),a=c(r);x(t=>L(a,t),[()=>new Date().toLocaleTimeString()]),_(i,l)};T(p,i=>{j.showSystemMessage&&!q.isAuthenticated&&i(h)})}var n=M(p,2);ae(n,17,()=>F,se,(i,l)=>{var w=X(),S=Z(w);{var r=t=>{var o=ye(),f=c(o),k=c(f);O(k,()=>u(l).content.replace(/\n/g,"<br>"));var E=M(f,2),N=c(E);x($=>{H(o,1,`message ${u(l).type??""}`,"svelte-3u4su5"),L(N,$)},[()=>new Date(u(l).timestamp).toLocaleTimeString()]),_(t,o)},a=t=>{const o=W(()=>u(l).model||""),f=W(()=>u(l).tokenUsage||{});be(t,{get role(){return u(l).role},get content(){return u(l).content},get timestamp(){return u(l).timestamp},get model(){return u(o)},get tokenUsage(){return u(f)}})};T(S,t=>{u(l).role==="system"&&u(l).type?t(r):t(a,!1)})}_(i,w)});var d=M(n,2);{var y=i=>{var l=Ce();_(i,l)};T(d,i=>{j.isLoading&&i(y)})}J(m,i=>s=i,()=>s),_(b,m),A()}function Se(b,e){b.key==="Enter"&&!b.shiftKey&&(b.preventDefault(),e())}function Me(b,e){e()}var Te=C('<div class="loading-spinner svelte-e5yfmv"></div>'),Le=C('<span class="send-icon svelte-e5yfmv">↑</span>'),Ue=C('<div class="input-hint svelte-e5yfmv">Press Enter to send, Shift+Enter for new line</div>'),He=C('<div class="chat-input-container svelte-e5yfmv"><div class="input-wrapper svelte-e5yfmv"><textarea class="chat-input svelte-e5yfmv" rows="1" autocomplete="off" autocapitalize="off" spellcheck="false" placeholder="Type your message..." aria-label="Chat message input"></textarea> <button aria-label="Send message"><!></button></div> <!></div>');function Ne(b,e){z(e,!0);let s=R(""),v=R(void 0);async function g(){var a;const r=u(s).trim();!r||j.isLoading||(P(s,""),m(),(a=e.onScrollToBottom)==null||a.call(e),await le.sendMessage(r))}function m(){if(!u(v))return;u(v).style.height="auto";const r=Math.min(u(v).scrollHeight,120);u(v).style.height=`${r}px`}B(()=>{u(s)!==void 0&&u(v)&&m()});var p=He(),h=c(p),n=c(h);n.__input=[Me,m],n.__keydown=[Se,g],J(n,r=>P(v,r),()=>u(v));var d=M(n,2);d.__click=g;var y=c(d);{var i=r=>{var a=Te();_(r,a)},l=r=>{var a=Le();_(r,a)};T(y,r=>{j.isLoading?r(i):r(l,!1)})}var w=M(h,2);{var S=r=>{var a=Ue();_(r,a)};T(w,r=>{F.length===0&&r(S)})}x((r,a)=>{n.disabled=j.isLoading,H(d,1,`send-button ${r??""}`,"svelte-e5yfmv"),d.disabled=a},[()=>!u(s).trim()||j.isLoading?"disabled":"",()=>!u(s).trim()||j.isLoading]),ne(n,()=>u(s),r=>P(s,r)),_(b,p),A()}G(["input","keydown","click"]);export{Be as C,Ke as H,Ne as a};
