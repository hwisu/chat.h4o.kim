import{d as G,p as B,f as C,c,s as j,i as U,t as S,a as p,b as N,e as se,g as I,h as A,j as H,k as D,l as z,u as P,m as v,n as O,o as Z,q as F,r as J,v as q,w as ae,x as $,y as ee,z as ne,A as oe,B as le,C as Y,D as re}from"./svelte.js";import{m as ie,r as ce,a as te,b as W,u as K,c as ve}from"./services.js";import{H as T,j as de,t as ge,p as ue,a as he,c as me,x as Q,b as V}from"./highlight.js";import{m as R}from"./marked.js";console.warn("Warning: stores.js is deprecated. Please use individual store imports from ./stores/ directory.");var fe=C('<div class="chat-header svelte-umztmj"><div class="chat-title svelte-umztmj"><button aria-label="Select model"> </button> <button class="role-title svelte-umztmj" aria-label="Select role"> </button></div> <div class="header-right svelte-umztmj"><div class="header-info svelte-umztmj"><div class="context-info svelte-umztmj"> </div> <div class="auth-status svelte-umztmj"><!></div></div></div></div>');function Fe(b,e){B(e,!0);const[a,d]=se(),h=()=>I(te,"$authStore",a),_=()=>I(ie,"$modelsStore",a),k=()=>I(ce,"$rolesStore",a);var g=fe(),n=c(g),r=c(n);let y;r.__click=function(...x){var M;(M=e.onModelClick)==null||M.apply(this,x)};var i=c(r),o=j(r,2);o.__click=function(...x){var M;(M=e.onRoleClick)==null||M.apply(this,x)};var w=c(o),L=j(n,2),l=c(L),t=c(l),s=c(t),m=j(t,2),u=c(m);{var f=x=>{var M=D("Server Key");p(x,M)},E=x=>{var M=D();S(()=>H(M,h().status)),p(x,M)};U(u,x=>{h().isAuthenticated?x(f):x(E,!1)})}S((x,M)=>{y=A(r,1,"model-title svelte-umztmj",null,y,x),H(i,_().selectedInfo.name),H(w,k().selectedInfo.name),H(s,`Context: ${M??""}K`)},[()=>({authenticated:h().isAuthenticated}),()=>Math.round(_().selectedInfo.contextSize/1e3)]),p(b,g),N(),d()}G(["click"]);var _e=C('<span class="message-label svelte-1kg7gi5"> </span>'),pe=C('<span class="message-label svelte-1kg7gi5"> </span>'),ke=C("<div><!></div>");function be(b,e){B(e,!0);let a=z(e,"model",3,"");function d(n){return new Date(n).toLocaleTimeString("ko-KR",{hour:"2-digit",minute:"2-digit",hour12:!0})}var h=ke(),_=c(h);{var k=n=>{var r=_e(),y=c(r);S(i=>H(y,`[USER] ${i??""}`),[()=>d(e.timestamp)]),p(n,r)},g=n=>{var r=pe(),y=c(r);S(i=>H(y,`[ASSISTANT] ${i??""}${a()?` - ${a()}`:""}`),[()=>d(e.timestamp)]),p(n,r)};U(_,n=>{e.role==="user"?n(k):n(g,!1)})}S(()=>A(h,1,`message-header ${e.role??""}`,"svelte-1kg7gi5")),p(b,h),N()}var we=C("<div><!></div>");function X(b,e){B(e,!0),T.registerLanguage("javascript",de),T.registerLanguage("typescript",ge),T.registerLanguage("python",ue),T.registerLanguage("json",he),T.registerLanguage("css",me),T.registerLanguage("html",Q),T.registerLanguage("xml",Q),T.registerLanguage("bash",V),T.registerLanguage("sh",V);let a=z(e,"content",3,""),d=z(e,"role",3,"assistant"),h,_=O("");P(()=>{console.log("🔥 CONTENT CHANGED:",{length:a().length,preview:a().substring(0,100),hasCodeBlock:a().includes("```")})});function k(t){const s=document.createElement("div");return s.textContent=t,s.innerHTML}function g(t,s){var m,u;console.log("🎨 highlightCode called with:",{codeLength:t.length,language:s,codePreview:t.substring(0,50)+"..."}),console.log("✅ hljs available, available languages:",((u=(m=T).listLanguages)==null?void 0:u.call(m))||"listLanguages not available");try{if(s&&T.getLanguage(s)){console.log(`🔍 Highlighting with specific language: ${s}`);const f=T.highlight(t.trim(),{language:s});return console.log("✅ Code highlighting successful for",s,"result length:",f.value.length),console.log("🎨 Highlighted result preview:",f.value.substring(0,100)+"..."),f.value}else{console.log("🔍 Auto-detecting language...");const f=T.highlightAuto(t.trim());return console.log("✅ Auto-highlighting successful, detected language:",f.language,"result length:",f.value.length),console.log("🎨 Highlighted result preview:",f.value.substring(0,100)+"..."),f.value}}catch(f){return console.warn("❌ Code highlighting failed:",f),k(t)}}function n(t){if(console.log("📝 processMarkdown called with text length:",t.length),console.log("📝 Text preview:",t.substring(0,200)+"..."),!t)return console.log("❌ No text provided"),"";console.log("🔍 Using npm packages: marked and hljs available");try{const s=new R.Renderer;s.code=function({text:u,lang:f}){console.log("🔧 renderer.code called:",{codeLength:u.length,language:f,codePreview:u.substring(0,50)+"..."});const E=g(u,f);return console.log("🔧 renderer.code result length:",E.length),`<pre><code class="language-${f||"text"} hljs">${E}</code></pre>`},R.setOptions({breaks:!0,gfm:!0,renderer:s});const m=R.parse(t);return console.log("✅ Markdown parsing successful, result length:",m.length),console.log("📝 Parsed result preview:",m.substring(0,200)+"..."),m}catch(s){return console.warn("❌ Markdown parsing failed:",s),console.log("🔄 Falling back to fallbackMarkdown"),r(t)}}function r(t){console.log("🔄 fallbackMarkdown called with text length:",t.length);const s=t.replace(/```(\w+)?\n([\s\S]*?)```/g,(m,u,f)=>{console.log("🔄 fallback processing code block:",{lang:u,codeLength:f.length,codePreview:f.substring(0,50)+"..."});const E=g(f,u);console.log("🔄 fallback highlighted code length:",E.length);const x=`<pre><code class="language-${u||"text"} hljs">${E}</code></pre>`;return console.log("🔄 fallback block result length:",x.length),x}).replace(/`([^`]+)`/g,"<code>$1</code>").replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/\n/g,"<br>");return console.log("🔄 fallbackMarkdown result length:",s.length),console.log("🔄 fallbackMarkdown result preview:",s.substring(0,200)+"..."),s}function y(t){var u;const s=t.target,m=(u=s.closest(".code-block-container"))==null?void 0:u.querySelector("code");m&&navigator.clipboard.writeText(m.textContent||"").then(()=>{s.textContent="✓",setTimeout(()=>{s.textContent="copy"},1e3)})}async function i(){if(await ae(),!h)return;h.querySelectorAll("pre:not(.processed)").forEach(s=>{var f;const m=document.createElement("div");m.className="code-block-container";const u=document.createElement("button");u.className="copy-code-btn",u.textContent="copy",u.title="Copy code",u.addEventListener("click",y),(f=s.parentNode)==null||f.insertBefore(m,s),m.appendChild(u),m.appendChild(s),s.classList.add("processed")})}function o(){console.log("🚀 processContent called with content length:",a().length),console.log("🚀 Content preview:",a().substring(0,100)+"..."),q(_,n(a()),!0),console.log("🚀 processContent finished, processedContent length:",v(_).length),console.log("🚀 ProcessedContent preview:",v(_).substring(0,200)+"...")}P(()=>{a()&&o()}),P(()=>{v(_)&&h&&i()}),Z(()=>{o()});var w=we();let L;var l=c(w);F(l,()=>v(_)),J(w,t=>h=t,()=>h),S(t=>L=A(w,1,"code-highlighter svelte-ezov7",null,L,t),[()=>({user:d()==="user",assistant:d()==="assistant"})]),p(b,w),N()}var ye=C('<div class="user-message-wrapper svelte-1xhsxcs"><div><!></div></div>'),xe=C("<div><!></div>");function Ce(b,e){var a=$(),d=ee(a);{var h=k=>{var g=ye(),n=c(g),r=c(n);X(r,{get content(){return e.content},get role(){return e.role}}),S(()=>A(n,1,`message-content ${e.role??""}`,"svelte-1xhsxcs")),p(k,g)},_=k=>{var g=xe(),n=c(g);X(n,{get content(){return e.content},get role(){return e.role}}),S(()=>A(g,1,`message-content ${e.role??""}`,"svelte-1xhsxcs")),p(k,g)};U(d,k=>{e.role==="user"?k(h):k(_,!1)})}p(b,a)}function Se(b,e){navigator.clipboard.writeText(e.content).then(()=>{})}var Le=C('<div class="message-footer svelte-sspqos"><div class="token-usage svelte-sspqos"><!></div> <button class="copy-button svelte-sspqos">Copy all</button></div>');function Me(b,e){B(e,!0);var a=Le(),d=c(a),h=c(d);{var _=n=>{var r=D();S((y,i,o)=>H(r,`↑ ${y??""}K ↓ ${i??""}K (total: ${o??""}K)`),[()=>Math.round(e.tokenUsage.prompt_tokens/1e3),()=>Math.round(e.tokenUsage.completion_tokens/1e3),()=>Math.round((e.tokenUsage.total_tokens||e.tokenUsage.prompt_tokens+e.tokenUsage.completion_tokens)/1e3)]),p(n,r)},k=(n,r)=>{{var y=o=>{var w=D();S(L=>H(w,`total: ${L??""}K`),[()=>Math.round(e.tokenUsage.total_tokens/1e3)]),p(o,w)},i=(o,w)=>{{var L=l=>{var t=D();S((s,m)=>H(t,`↑ ${s??""}K ↓ ${m??""}K`),[()=>Math.round(e.tokenUsage.input/1e3),()=>Math.round(e.tokenUsage.output/1e3)]),p(l,t)};U(o,l=>{e.tokenUsage.input&&e.tokenUsage.output&&l(L)},w)}};U(n,o=>{e.tokenUsage.total_tokens?o(y):o(i,!1)},r)}};U(h,n=>{e.tokenUsage.prompt_tokens&&e.tokenUsage.completion_tokens?n(_):n(k,!1)})}var g=j(d,2);g.__click=[Se,e],p(b,a),N()}G(["click"]);var Te=C("<div><!> <!> <!></div>");function je(b,e){let a=z(e,"role",3,"user"),d=z(e,"content",3,""),h=z(e,"timestamp",19,()=>Date.now()),_=z(e,"model",3,""),k=z(e,"tokenUsage",19,()=>({}));var g=Te(),n=c(g);be(n,{get role(){return a()},get timestamp(){return h()},get model(){return _()}});var r=j(n,2);Ce(r,{get role(){return a()},get content(){return d()}});var y=j(r,2);{var i=o=>{Me(o,{get tokenUsage(){return k()},get content(){return d()}})};U(y,o=>{a()==="assistant"&&o(i)})}S(()=>{A(g,1,`message ${a()??""}`,"svelte-12i571y"),ne(g,"data-timestamp",h())}),p(b,g)}var Ue=C('<div class="message system svelte-3u4su5"><div class="message-content svelte-3u4su5"><!></div> <div class="message-timestamp svelte-3u4su5"> </div></div>'),He=C('<div><div class="message-content svelte-3u4su5"><!></div> <div class="message-timestamp svelte-3u4su5"> </div></div>'),Ee=C('<div class="message assistant loading svelte-3u4su5"><div class="message-content svelte-3u4su5"><div class="loading-dots svelte-3u4su5"><span class="svelte-3u4su5"></span> <span class="svelte-3u4su5"></span> <span class="svelte-3u4su5"></span></div></div></div>'),ze=C('<div class="chat-output svelte-3u4su5"><!> <!> <!></div>');function We(b,e){B(e,!0);let a;function d(){a&&(a.scrollTop=a.scrollHeight)}P(()=>{W.length,d()}),Z(()=>{d()});function h(){return`[SYSTEM] ${new Date().toLocaleString()}

🌟 Choose access method:

🔐 Server Login: /login <password>
🔑 Personal Key: /set-api-key <key>

💡 Choose ONE option`}var _=ze(),k=c(_);{var g=i=>{var o=Ue(),w=c(o),L=c(w);F(L,()=>h().replace(/\n/g,"<br>"));var l=j(w,2),t=c(l);S(s=>H(t,s),[()=>new Date().toLocaleTimeString()]),p(i,o)};U(k,i=>{K.showSystemMessage&&!te.isAuthenticated&&i(g)})}var n=j(k,2);oe(n,17,()=>W,le,(i,o)=>{var w=$(),L=ee(w);{var l=s=>{var m=He(),u=c(m),f=c(u);F(f,()=>v(o).content.replace(/\n/g,"<br>"));var E=j(u,2),x=c(E);S(M=>{A(m,1,`message ${v(o).type??""}`,"svelte-3u4su5"),H(x,M)},[()=>new Date(v(o).timestamp).toLocaleTimeString()]),p(s,m)},t=s=>{const m=Y(()=>v(o).model||""),u=Y(()=>v(o).tokenUsage||{});je(s,{get role(){return v(o).role},get content(){return v(o).content},get timestamp(){return v(o).timestamp},get model(){return v(m)},get tokenUsage(){return v(u)}})};U(L,s=>{v(o).role==="system"&&v(o).type?s(l):s(t,!1)})}p(i,w)});var r=j(n,2);{var y=i=>{var o=Ee();p(i,o)};U(r,i=>{K.isLoading&&i(y)})}J(_,i=>a=i,()=>a),p(b,_),N()}function Ae(b,e){b.key==="Enter"&&!b.shiftKey&&(b.preventDefault(),e())}function Ke(b,e){e()}var Be=C('<div class="loading-spinner svelte-e5yfmv"></div>'),Ne=C('<span class="send-icon svelte-e5yfmv">↑</span>'),De=C('<div class="input-hint svelte-e5yfmv">Press Enter to send, Shift+Enter for new line</div>'),Pe=C('<div class="chat-input-container svelte-e5yfmv"><div class="input-wrapper svelte-e5yfmv"><textarea class="chat-input svelte-e5yfmv" rows="1" autocomplete="off" autocapitalize="off" spellcheck="false" placeholder="Type your message..." aria-label="Chat message input"></textarea> <button aria-label="Send message"><!></button></div> <!></div>');function Ge(b,e){B(e,!0);let a=O(""),d=O(void 0);async function h(){var t;const l=v(a).trim();!l||K.isLoading||(q(a,""),_(),(t=e.onScrollToBottom)==null||t.call(e),await ve.sendMessage(l))}function _(){if(!v(d))return;v(d).style.height="auto";const l=Math.min(v(d).scrollHeight,120);v(d).style.height=`${l}px`}P(()=>{v(a)!==void 0&&v(d)&&_()});var k=Pe(),g=c(k),n=c(g);n.__input=[Ke,_],n.__keydown=[Ae,h],J(n,l=>q(d,l),()=>v(d));var r=j(n,2);r.__click=h;var y=c(r);{var i=l=>{var t=Be();p(l,t)},o=l=>{var t=Ne();p(l,t)};U(y,l=>{K.isLoading?l(i):l(o,!1)})}var w=j(g,2);{var L=l=>{var t=De();p(l,t)};U(w,l=>{W.length===0&&l(L)})}S((l,t)=>{n.disabled=K.isLoading,A(r,1,`send-button ${l??""}`,"svelte-e5yfmv"),r.disabled=t},[()=>!v(a).trim()||K.isLoading?"disabled":"",()=>!v(a).trim()||K.isLoading]),re(n,()=>v(a),l=>q(a,l)),p(b,k),N()}G(["input","keydown","click"]);export{We as C,Fe as H,Ge as a};
